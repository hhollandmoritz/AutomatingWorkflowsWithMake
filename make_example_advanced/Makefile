.PHONY : help clean my-data-clean my-analyses all main supp 
.DEFAULT_GOAL := all

# All figures (still need to update this)
## all : makes main and supplementary figures
all: main supp
	@echo "Making all figures and tables"


main: figures/iris_sepal_plot.png

supp: figures/setosa_sepal_plot.png \
figures/virginica_sepal_plot.png \
figures/versicolor_sepal_plot.png

# Analyses =============================================================================================
## my-analyses : runs the primary data analyses

my-analyses: figures/iris_sepal_plot.png \
outputs/sep_width_len_all.mod.RDS \
figures/versicolor_sepal_plot.png \
outputs/sep_width_len_ver.mod.RDS \
figures/virginica_sepal_plot.png \
outputs/sep_width_len_vir.mod.RDS \
figures/setosa_sepal_plot.png \
outputs/sep_width_len_set.mod.RDS 
	@echo "Primary Analyses"

# All
figures/iris_sepal_plot.png \
outputs/sep_width_len_all.mod.RDS: R/05_all_species.R 01_cleaned_data/iris.RDS R/00_directory_setup.R
	@echo "All Species"
	# If output folders to hold the *.Rout files, figures, and outputs don't exist, then make them
	mkdir -p figures
	mkdir -p outputs
	mkdir -p Rout
	# Run the Rscript
	R CMD BATCH R/05_all_species.R \
		Rout/05_all_species.Rout
	# Change the name of any Rplots.pdf (generically created by R CMD BATCH) to the name of the script
	if [ -f Rplots.pdf ]; \
	then \
	   mv Rplots.pdf Rout/05_all_species.pdf; \
	fi;


# Versicolor

figures/versicolor_sepal_plot.png \
outputs/sep_width_len_ver.mod.RDS: R/04_versicolor.R 01_cleaned_data/iris.ver.RDS R/00_directory_setup.R
	@echo "Versicolor"
	mkdir -p figures
	mkdir -p outputs
	mkdir -p Rout
	R CMD BATCH R/04_versicolor.R \
		Rout/04_versicolor.Rout
	if [ -f Rplots.pdf ]; \
	then \
	   mv Rplots.pdf Rout/04_versicolor.pdf; \
	fi;



# Virginica

figures/virginica_sepal_plot.png \
outputs/sep_width_len_vir.mod.RDS: R/03_virginica.R 01_cleaned_data/iris.vir.RDS R/00_directory_setup.R
	@echo "Virginica"
	mkdir -p figures
	mkdir -p outputs
	mkdir -p Rout
	R CMD BATCH R/03_virginica.R \
		Rout/03_virginica.Rout
	if [ -f Rplots.pdf ]; \
	then \
	   mv Rplots.pdf Rout/03_virginica.pdf; \
	fi;


# Setosa

figures/setosa_sepal_plot.png \
outputs/sep_width_len_set.mod.RDS: R/02_setosa.R 01_cleaned_data/iris.set.RDS R/00_directory_setup.R
	@echo "Setosa"
	mkdir -p figures
	mkdir -p outputs
	mkdir -p Rout
	R CMD BATCH R/02_setosa.R \
		Rout/02_setosa.Rout
	if [ -f Rplots.pdf ]; \
	then \
	   mv Rplots.pdf Rout/02_setosa.pdf; \
	fi;

# Cleaning Data ==================================================================================
## my-data-clean : cleans data in preparation for primary analyses

my-data-clean: 01_cleaned_data/iris.RDS \
01_cleaned_data/iris.set.RDS \
01_cleaned_data/iris.ver.RDS \
01_cleaned_data/iris.vir.RDS
	@echo "Cleaned data"


# Files from 01_loading_data_and_cleaning_mapping_file.R
01_cleaned_data/iris.RDS \
01_cleaned_data/iris.set.RDS \
01_cleaned_data/iris.ver.RDS \
01_cleaned_data/iris.vir.RDS: R/01_loading_and_cleaning_data.R 00_raw_data/iris.txt R/00_directory_setup.R
	@echo "Creating $@"
	mkdir -p Rout
	R CMD BATCH R/01_loading_and_cleaning_data.R \
		Rout/01_loading_and_cleaning_data.Rout
	if [ -f Rplots.pdf ]; \
	then \
	   mv Rplots.pdf Rout/01_loading_and_cleaning_data.pdf; \
	fi;



# Makefile Cleaning ==============================================================================
## clean : removes all files generated by this make file

clean:
	rm -f figures/*.png
	rm -f outputs/*.RDS
	rm -f Rout/*.pdf
	rm -f Rout/*.Rout

# Makefile help ==============================================================================
## help : displays this help message of targets and their actions
help: Makefile
	@echo "Targets to make:"
	@sed -n 's/^##/        /p' $<
	@echo ""
